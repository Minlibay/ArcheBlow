# ๐ Metrics & Methodology โ ArcheBlow

ะะพะบัะผะตะฝั ะพะฟะธััะฒะฐะตั **ะผะตััะธะบะธ ะบะฐัะตััะฒะฐ**, **ะผะตััะธะบะธ ะดะฐะฝะฝัั**, **ะผะตััะธะบะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ะธ ะฝะฐะดัะถะฝะพััะธ (SLA/SLO/SLI)**, ะฐ ัะฐะบะถะต **ะผะตัะพะดะธะบั ัะฐััััะฐ ัะธัะบ-ะธะฝะดะตะบัะฐ**. ะคะพัะผัะปั ะฟัะธะฒะตะดะตะฝั ะฒ ัะดะพะฑะฝะพะน ะดะปั ัะฐะทัะฐะฑะพััะธะบะพะฒ ะธ ะฐะฝะฐะปะธัะธะบะพะฒ ัะพัะผะต.

---

## 1) ะะฟัะตะดะตะปะตะฝะธั ะธ ะฟัะพัะพะบะพะป ะพัะตะฝะบะธ

**ะกััะฝะพััะธ**
- `address` โ ะฐะดัะตั/ะบะพัะตะปัะบ ะฒ ะฑะปะพะบัะตะนะฝะต.
- `tx` โ ััะฐะฝะทะฐะบัะธั.
- `cluster` โ ะผะฝะพะถะตััะฒะพ ะฐะดัะตัะพะฒ, ะฟัะตะดะฟะพะปะพะถะธัะตะปัะฝะพ ะฟัะธะฝะฐะดะปะตะถะฐัะธั ะพะดะฝะพะผั ััะฑัะตะบัั.
- `mixer` โ ัะตัะฒะธั ะพะฑัััะบะฐัะธะธ/ะผะธะบัะธัะพะฒะฐะฝะธั.

**ะะฐัะฐัะตัั**
- `TRAIN` / `VALID` / `TEST` โ ัะฐะทะฑะธะตะฝะธะต ั **ัะตะผะฟะพัะฐะปัะฝัะผ ัะดะฒะธะณะพะผ** (train ะดะพ T0, valid T0โT1, test ะฟะพัะปะต T1) ะดะปั ะฟัะตะดะพัะฒัะฐัะตะฝะธั ะปะธะบะฐ ะฑัะดััะตะณะพ.
- ะัะต ะผะตััะธะบะธ ััะฒะตัะถะดะฐัััั ะฝะฐ `TEST`, ะทะฝะฐัะตะฝะธั ะธ ะดะพะฒะตัะธัะตะปัะฝัะต ะธะฝัะตัะฒะฐะปั (ะะ) ััะธัะฐัััั ะฑัััััะฐะฟะพะผ (1000 ะฒัะฑะพัะพะบ, ะะ 95%).

**ะะฑะพะทะฝะฐัะตะฝะธั**
- TP โ ะธััะธะฝะฝะพ-ะฟะพะปะพะถะธัะตะปัะฝัะต, FP โ ะปะพะถะฝะพะฟะพะปะพะถะธัะตะปัะฝัะต, FN โ ะปะพะถะฝะพะพััะธัะฐัะตะปัะฝัะต, TN โ ะธััะธะฝะฝะพ-ะพััะธัะฐัะตะปัะฝัะต.
- ะะปั ะฒะตัะพััะฝะพััะฝัั ะผะพะดะตะปะตะน ะฟัะธะผะตะฝัะตััั ะบะฐะปะธะฑัะพะฒะบะฐ (Platt/Isotonic).

---

## 2) ะะตััะธะบะธ ML-ะบะปะฐััะธัะธะบะฐัะธะธ

### 2.1 ะะฐะทะพะฒัะต
- **Precision**:  
  \[
  \mathrm{Precision}=\frac{TP}{TP+FP}
  \]
- **Recall**:  
  \[
  \mathrm{Recall}=\frac{TP}{TP+FN}
  \]
- **F1-score**:  
  \[
  F1=\frac{2\cdot \mathrm{Precision}\cdot \mathrm{Recall}}{\mathrm{Precision}+\mathrm{Recall}}
  \]
- **AUC-ROC** โ ะฟะปะพัะฐะดั ะฟะพะด ROC-ะบัะธะฒะพะน.
- **PR-AUC** โ ะฟะปะพัะฐะดั ะฟะพะด PrecisionโRecall (ะฒะฐะถะฝะพ ะฟัะธ ะดะธัะฑะฐะปะฐะฝัะต ะบะปะฐััะพะฒ).

### 2.2 ะะฐะปะธะฑัะพะฒะบะฐ ะฒะตัะพััะฝะพััะตะน
- **Brier score**:  
  \[
  \mathrm{Brier}=\frac{1}{N}\sum_{i=1}^{N}(p_i-y_i)^2
  \]
- **ECE (Expected Calibration Error)**: ะฑะธะฝะฝะธะฝะณ ะฟะพ ะฒะตัะพััะฝะพัััะผ ะธ ัััะตะดะฝะตะฝะธะต |confโacc|.

### 2.3 ะะตััะธะบะธ ะดะตัะตะบัะธะธ ะผะธะบัะตัะพะฒ
- **TPR** (ััะฒััะฒะธัะตะปัะฝะพััั): \(\frac{TP}{TP+FN}\)  
- **FPR**: \(\frac{FP}{FP+TN}\)  
- **Balanced Accuracy**: \(\frac{TPR + TNR}{2}\)

**ะะฟะตัะฐัะธะพะฝะฝะฐั ัะพัะบะฐ** ะฒัะฑะธัะฐะตััั ะฟะพ **ััะพะธะผะพัััะผ ะพัะธะฑะพะบ**:
\[
\text{Expected Cost} = C_{FP}\cdot FP + C_{FN}\cdot FN
\]
ะะดะต \(C_{FN} > C_{FP}\) ะฒ ะบะพะผะฟะปะฐะตะฝั-ะบะพะฝัะตะบััะต. ะะพัะพะณ ะฟะพะดะฑะธัะฐะตััั ะผะธะฝะธะผะธะทะฐัะธะตะน Expected Cost ะฝะฐ `VALID`.

---

## 3) ะะตััะธะบะธ ะณัะฐัะพะฒะพะณะพ ะฐะฝะฐะปะธะทะฐ

### 3.1 ะะพะบัััะธะต ะณัะฐัะฐ
- **Node coverage**:  
  \[
  \mathrm{NC}=\frac{|V_{\text{found}}|}{|V_{\text{ref}}|}
  \]
- **Edge coverage**:  
  \[
  \mathrm{EC}=\frac{|E_{\text{found}}|}{|E_{\text{ref}}|}
  \]
ะฆะตะปะตะฒะพะต ะทะฝะฐัะตะฝะธะต: โฅ 95%.

### 3.2 ะขัะฐััะธัะพะฒะบะฐ ะฟะพัะพะบะพะฒ
- **Path recall@k** โ ะดะพะปั ััะฐะปะพะฝะฝัั ะฟััะตะน (ะดะพ ะดะปะธะฝั \(k\)), ะฝะฐะนะดะตะฝะฝัั ะฐะปะณะพัะธัะผะพะผ.  
  \[
  \mathrm{PathRecall@k}=\frac{\#\ \text{ััะฐะปะพะฝะฝัั ะฟััะตะน ะดะปะธะฝั}\le k\ \text{ะฝะฐะนะดะตะฝะพ}}{\#\ \text{ััะฐะปะพะฝะฝัั ะฟััะตะน ะดะปะธะฝั}\le k}
  \]

### 3.3 ะะปะฐััะตัะธะทะฐัะธั
- **Modularity (Q)** โ ะบะฐัะตััะฒะพ ัะฐะทะฑะธะตะฝะธั ะฝะฐ ัะพะพะฑัะตััะฒะฐ.
- **ARI (Adjusted Rand Index)** โ ะตัะปะธ ะตััั ััะฐะปะพะฝะฝะพะต ัะฐะทะผะตัะฐะฝะฝะพะต ะณััะฟะฟะพะฒะพะต ัะพะพัะฒะตัััะฒะธะต.

---

## 4) ะะตััะธะบะธ ะดะฐะฝะฝัั (Data Quality)

| ะะตััะธะบะฐ | ะคะพัะผัะปะฐ / ะัะพะฒะตัะบะฐ | ะฆะตะปั |
|---|---|---|
| **Freshness** | `now() - max(data_timestamp)` | โค 1 ัะฐั (ะดะปั ะพะฟะตัะฐัะธะฒะฝัั ัะธะดะพะฒ) |
| **Completeness** | 1 โ (ะฟััััะต_ะทะฝะฐัะตะฝะธั / ะฒัะต_ะทะฝะฐัะตะฝะธั) | โฅ 99% |
| **Schema validity** | % ะทะฐะฟะธัะตะน, ะฟัะพัะตะดัะธั ะฒะฐะปะธะดะฐัะธั ััะตะผั | 100% |
| **Duplicates rate** | ะดัะฑะปะธ / ะทะฐะฟะธัะธ | โค 0.1% |
| **Source coverage** | ะฐะดัะตัะฐ ั ะผะตัะฐะดะฐะฝะฝัะผะธ / ะฒัะต ะฐะดัะตัะฐ | โฅ 80% |

---

## 5) SLA / ะะฐะดัะถะฝะพััั / ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### 5.1 ะะฟัะตะดะตะปะตะฝะธั (SLI/SLO/SLA)
- **SLI** โ ะธะทะผะตััะตะผัะน ะธะฝะดะธะบะฐัะพั (ะฝะฐะฟัะธะผะตั, p95 latency).
- **SLO** โ ัะตะปะตะฒะพะต ะทะฝะฐัะตะฝะธะต SLI (ะฝะฐะฟัะธะผะตั, p95 โค 3s).
- **SLA** โ ะดะพะณะพะฒะพัะฝะพะน ััะพะฒะตะฝั ั ะฟะพัะปะตะดััะฒะธัะผะธ ะฟัะธ ะฝะฐัััะตะฝะธะธ.

### 5.2 ะะพัััะฟะฝะพััั ะธ ะฑัะดะถะตั ะพัะธะฑะพะบ
- **Availability (ะผะตััั)**:  
  \[
  \mathrm{Uptime}=\frac{T_{\text{ัะฐะฑ}}}{T_{\text{ะบะฐะปะตะฝะดะฐัั}}}\times 100\%
  \]
**SLO**: Uptime โฅ 99.0% (ะพัะธะฑะพัะฝัะน ะฑัะดะถะตั โค 1% ะฒัะตะผะตะฝะธ).

### 5.3 Latency
- **API latency p95** โค 3 ัะตะบ (ะพะฝะปะฐะนะฝ-ะทะฐะฟัะพัั).  
- **Report generation mean** โค 60 ัะตะบ (ะฑะฐัั/ะฐะฝะฐะปะธัะธะบะฐ).  
- **Cold start** (ะตัะปะธ ะตััั ััะฝะบัะธะธ/ัะบะตะนะปะธะฝะณ) โ p95 โค 5 ัะตะบ.

### 5.4 ะัะพะฟััะบะฝะฐั ัะฟะพัะพะฑะฝะพััั
- **Throughput** โฅ 100 req/min ะดะปั ััะฐะฝะดะฐััะฝะพะณะพ ะฟัะพัะธะปั (ะฝะฐ ะฝะฐะณััะทะพัะฝะพะผ ััะตะฝะดะต).

### 5.5 ะะฝัะธะดะตะฝัั ะธ ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต
- **MTTR**:  
  \[
  \mathrm{MTTR}=\frac{\sum \text{ะฒัะตะผั ะฒะพัััะฐะฝะพะฒะปะตะฝะธั}}{\#\ \text{ะธะฝัะธะดะตะฝัะพะฒ}}\ \le 5\ \text{ะผะธะฝ}
  \]
- **MTBF** โ ััะตะดะฝะตะต ะฒัะตะผั ะผะตะถะดั ะพัะบะฐะทะฐะผะธ (ะดะพะปะถะฝะพ ัะฐััะธ).

### 5.6 ะะทะผะตัะตะฝะธั ะธ ะพะบะฝะพ ะฝะฐะฑะปัะดะตะฝะธะน
- ะะบะฝะพ: ะบะฐะปะตะฝะดะฐัะฝัะน ะผะตััั (SLA) ะธ 7 ะดะฝะตะน (ะพะฟะตัะฐัะธะฒะฝัะน ะบะพะฝััะพะปั).
- ะะฝััััะผะตะฝัั: Prometheus/Grafana + ะฐะปะตััั (Slack/Telegram).  
- ะฃัะธััะฒะฐัััั **ัะพะปัะบะพ ััะฟะตัะฝัะต 2xx/3xx** ะพัะฒะตัั; 4xx/5xx โ ะพัะธะฑะบะธ.

---

## 6) ะะพะฝะธัะพัะธะฝะณ ะดัะตะนัะฐ ะธ ััะฐะฑะธะปัะฝะพััะธ

| ะะตััะธะบะฐ | ะะฟะธัะฐะฝะธะต | ะฆะตะปั |
|---|---|---|
| **PSI (Population Stability Index)** | ะกัะฐะฑะธะปัะฝะพััั ัะฐัะฟัะตะดะตะปะตะฝะธะน ะฟัะธะทะฝะฐะบะพะฒ/ัะบะพัะธะฝะณะพะฒ | โค 0.2 (ะฝะพัะผะฐ), 0.2โ0.3 (ะฒะฝะธะผะฐะฝะธะต), > 0.3 (ะฐะปะตัั) |
| **KL-divergence** | ะะฐััะพะถะดะตะฝะธะต ัะฐัะฟัะตะดะตะปะตะฝะธะน | ะััะปะตะถะธะฒะฐะฝะธะต ััะตะฝะดะฐ |
| **Concept drift via label shift** | ะะทะผะตะฝะตะฝะธะต ะฑะฐะทะพะฒะพะน ะดะพะปะธ ะบะปะฐััะฐ | ะะปะตัั ะฟัะธ ฮ> 5 ะฟ.ะฟ. |
| **Performance decay** | ะกัะฐะฒะฝะตะฝะธะต Precision/Recall ะบ ะฑะฐะทะพะฒะพะน ะปะธะฝะธะธ | ะะปะตัั ะฟัะธ ะฟะฐะดะตะฝะธะธ > 5% |

---

## 7) ะะธัะบ-ะธะฝะดะตะบั (Risk Score) โ ัะพัะผัะปะฐ ะธ ะฟัะธะผะตั

### 7.1 ะะพะผะฑะธะฝะธัะพะฒะฐะฝะฝะฐั ะผะพะดะตะปั
ะะธัะบ-ะธะฝะดะตะบั ะพะฑัะตะดะธะฝัะตั:
1) **ML-ัะบะพั** \( s_{\text{ml}}\in[0,1] \) (ะบะฐะปะธะฑัะพะฒะฐะฝะฝัะน),  
2) **ะัะฐะฒะธะปะฐ/ัะฒัะธััะธะบะธ** \( \{r_j\} \in \{0,1\} \) (ัะปะฐะณะธ: ัะฐะฝะบั. ัะฟะธัะพะบ, ัะฒัะทั ั ะผะธะบัะตัะพะผ, ะฐะฝะพะผะฐะปะธะธ ะฟะพัะพะบะพะฒ ะธ ั.ะด.),  
3) **ะัะฐัะพะฒัะต ะฟัะธะทะฝะฐะบะธ** (PageRank-ะฝะพัะผะธัะพะฒะบะฐ, ัะตะฝััะฐะปัะฝะพััะธ, ะณะปัะฑะธะฝะฐ ะฟััะธ ะดะพ ะผะธะบัะตัะฐ).

**ะจะฐะณ 1. ะะพะณะธั ML:**  
\[
\ell_{\text{ml}}=\log\frac{s_{\text{ml}}}{1-s_{\text{ml}}}
\]

**ะจะฐะณ 2. ะะทะฒะตัะตะฝะฝะฐั ะปะธะฝะตะนะฝะฐั ะบะพะผะฑะธะฝะฐัะธั:**
\[
z = w_0 + w_{\text{ml}}\cdot \ell_{\text{ml}} + \sum_{j=1}^{m} w_j\cdot r_j + \sum_{k=1}^{p} \alpha_k \cdot g_k
\]
ะณะดะต \(g_k\) โ ะฝะพัะผะธัะพะฒะฐะฝะฝัะต ะณัะฐัะพะฒัะต ะฟัะธะทะฝะฐะบะธ (ะฝะฐะฟัะธะผะตั, z-score PageRank).

**ะจะฐะณ 3. ะกะธะณะผะพะธะดะฐ ะธ ัะบะฐะปะฐ 0โ100:**
\[
p=\sigma(z)=\frac{1}{1+e^{-z}},\quad \mathrm{Risk}= \lfloor 100\cdot p \rfloor
\]

**ะจะฐะณ 4. ะะฐัะตะณะพัะธะธ ัะธัะบะฐ (ะฟัะธะผะตั ะฟะพัะพะณะพะฒ):**
- 0โ29: **Low**
- 30โ59: **Medium**
- 60โ79: **High**
- 80โ100: **Critical**

### 7.2 ะัะธะผะตั ัะฐััััะฐ (ัะธัะปะพะฒะพะน)
- \( s_{\text{ml}}=0.78 \Rightarrow \ell_{\text{ml}}=\log(0.78/0.22)=\mathbf{1.273}\)  
- ะคะปะฐะณะธ: ัะฐะฝะบั. ัะฟะธัะพะบ \(r_1=1\), ะผะธะบัะตั-ะฟะฐััะตัะฝ \(r_2=1\), ะฐะฝะพะผะฐะปัะฝัะน ะฒัะฟะปะตัะบ \(r_3=0\)  
- ะัะฐั: \(g_1\) (ะฝะพัะผ. PageRank)=0.6, \(g_2\) (ะผะธะฝะธะผะฐะปัะฝะฐั ะดะธััะฐะฝัะธั ะดะพ ะผะธะบัะตัะฐ, ะพะฑัะฐัะฝะฐั ะฝะพัะผ.)=0.8  
- ะะตัะฐ (ะฟัะธะผะตั): \(w_0=-1.0\), \(w_{\text{ml}}=0.9\), \(w_1=1.2\), \(w_2=0.8\), \(w_3=0.3\), \(\alpha_1=0.5\), \(\alpha_2=0.7\)

ะะฐัััั:
\[
\begin{aligned}
z&=-1.0 + 0.9\cdot 1.273 + 1.2\cdot 1 + 0.8\cdot 1 + 0.3\cdot 0 + 0.5\cdot 0.6 + 0.7\cdot 0.8 \\
 &= -1.0 + 1.146 + 1.2 + 0.8 + 0 + 0.3 + 0.56 = \mathbf{3.006}
\end{aligned}
\]
\[
p=\sigma(3.006)=0.952,\quad \mathrm{Risk}=\lfloor 100\cdot 0.952 \rfloor=\mathbf{95}\Rightarrow \textbf{Critical}
\]

> ะัะธะผะตัะฐะฝะธะต: ะฒะตัะฐ ััะฐะฝัััั ะฒ ะบะพะฝัะธะณะต ะธ ะฟะพะดะปะตะถะฐั ะฒะตััะธะธะพะฝะธัะพะฒะฐะฝะธั. ะะทะผะตะฝะตะฝะธั ะฒะตัะพะฒ = ะฝะพะฒัะน ะผะธะฝะพัะฝัะน ัะตะปะธะท ัะบะพัะธะฝะณะฐ.

---

## 8) ะะตัะพะดะธะบะฐ ะฒัะฑะพัะฐ ะฟะพัะพะณะฐ (ะพะฟะตัะฐัะธะพะฝะฝะฐั ัะพัะบะฐ)

1. ะะฐะดะฐัั ััะพะธะผะพััะธ ะพัะธะฑะพะบ \(C_{FP}, C_{FN}\) (ัะพะฒะผะตััะฝะพ ั ะบะพะผะฟะปะฐะตะฝั/ััะธััะฐะผะธ).  
2. ะะฐ `VALID` ะฟัะพัะบะฐะฝะธัะพะฒะฐัั ะฟะพัะพะณ \(\tau\in[0,1]\).  
3. ะัะฑัะฐัั \(\tau=\arg\min_\tau \text{Expected Cost}(\tau)\).  
4. ะัะพะฒะตัะธัั ะฝะฐ `TEST`, ะทะฐัะธะบัะธัะพะฒะฐัั \(\tau\) ะฒ ะบะพะฝัะธะณะต.  
5. ะะพะฝะธัะพัะธัั **Precision/Recall**, **Expected Cost** ะฒะพ ะฒัะตะผะตะฝะธ (ะดัะตะนั).

---

## 9) ะััััะฝะพััั ะฟะพ ะผะตััะธะบะฐะผ

| ะะตัะธะพะดะธัะฝะพััั | ะงัะพ | ะัะดะฐ |
|---|---|---|
| ะะถะตะดะฝะตะฒะฝะพ | p95 latency, uptime, ะพัะธะฑะบะธ ะฟะพ ะบะพะดะฐะผ | Grafana ะดะฐัะฑะพัะด + ะฐะปะตััั |
| ะะถะตะฝะตะดะตะปัะฝะพ | Precision/Recall/F1, PR-AUC, ะบะฐะปะธะฑัะพะฒะบะฐ, PSI | MLflow ะฐััะตัะฐะบัั + ะพัััั PDF/JSON |
| ะะถะตะผะตัััะฝะพ | SLA-ัะฒะพะดะบะฐ, ะธะฝัะธะดะตะฝัั (MTTR/MTBF), ะฑะธะทะฝะตั-KPI | ะะตะฝะตะดะถะตััะบะธะน ะพัััั (PDF) |

---

## 10) ะะธะฝะธะผะฐะปัะฝัะต ัะตะปะตะฒัะต ะทะฝะฐัะตะฝะธั (ัะฒะพะดะบะฐ)

| ะะฑะปะฐััั | ะะตััะธะบะฐ | ะฆะตะปั |
|---|---|---|
| ะะปะฐััะธัะธะบะฐัะธั | Precision / Recall / F1 | โฅ 0.90 / โฅ 0.85 / โฅ 0.87 |
| ะะฐะปะธะฑัะพะฒะบะฐ | Brier / ECE | โ (ะบะพะฝััะพะปั ััะตะฝะดะฐ) |
| ะะธะบัะตัั | Accuracy / FPR | โฅ 0.88 / โค 0.10 |
| ะัะฐั | Node/Edge coverage | โฅ 95% |
| ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั | API p95 latency | โค 3s |
| ะััััั | ะัะตะผั ะณะตะฝะตัะฐัะธะธ | โค 60s |
| ะะพัััะฟะฝะพััั | Uptime (ะผะตััั) | โฅ 99.0% |
| ะะฐะดัะถะฝะพััั | MTTR | โค 5 ะผะธะฝ |
| ะะฐะฝะฝัะต | Freshness | โค 1 ัะฐั |

---

## 11) ะะตะฟัะพะดััะธััะตะผะพััั ะธ ะบะพะฝััะพะปั ะบะฐัะตััะฒะฐ

- ะคะธะบัะฐัะธั `random_seed`, ะฒะตััะธะพะฝะฝะพััั ะดะฐัะฐัะตัะพะฒ ะธ ัะธัะตะน.  
- ะฅัะฐะฝะตะฝะธะต ะผะตััะธะบ ะธ ะฐััะตัะฐะบัะพะฒ ะฒ MLflow/Weights&Biases.  
- ะะพะปะฝัะต ะปะพะณะธ ะฟะฐัะฐะผะตััะพะฒ ัะบัะฟะตัะธะผะตะฝัะพะฒ (git SHA, ะดะฐัะฐ, ะพะบััะถะตะฝะธะต, ัะตั ะดะฐะฝะฝัั).  
- ะะตะณัะตััะธะพะฝะฝัะต ัะตััั ะผะตััะธะบ: ัะตะปะธะท ะฑะปะพะบะธััะตััั ะฟัะธ ะดะตะณัะฐะดะฐัะธะธ > ะดะพะฟััะบะพะฒ.

---

**ArcheBlow ยฉ 2025 โ Metrics & Methodology**
